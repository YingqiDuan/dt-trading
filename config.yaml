data:
  exchange: binance  # ccxt exchange id (e.g., binance)
  symbol: BTC/USDT
  timeframe: 15m  # 1m|3m|5m|15m|30m|1h|2h|4h|6h|8h|12h|1d|3d|1w|1M
  symbols: null  # optional list for pooled training (e.g., ["BTC/USDT", "ETH/USDT"])
  timeframes: null  # optional list for pooled training (e.g., ["15m", "1h"])
  since: "2023-01-01"
  until: "2025-12-31"
  train_end: "2024-12-31"
  val_end: "2025-06-30"  # optional; if omitted, defaults to train_end
  test_end: "2025-12-31"
  limit: 1000
  raw_dir: data/raw
  feature_dir: data/features
  integrity:
    enabled: true
    gap_policy: fill  # fill|warn|error
    max_gap_bars: 1000

features:
  volatility_window: 24
  ma_window: 24
  ema_windows: [3, 6, 9, 12, 15, 18]
  boll_window: 12
  boll_n_std: 4.0
  macd_fast: 12
  macd_slow: 24
  macd_signal: 9
  rsi_window: 12
  volume_z_window: 24
  log_return_cum_windows: [16, 96]  # 4h, 1d when timeframe=15m
  zscore_window: 96
  skip_zscore: [boll_z]
  include_log_return: true  # true|false
  include_log_return_cum: true  # true|false
  include_volatility: true  # true|false
  include_volume: true  # true|false
  include_ema: true  # true|false
  include_boll: true  # true|false
  include_macd: true  # true|false
  include_price_to_ma: false  # true|false
  include_rsi: false  # true|false

rewards:
  fee: 0.0004
  slip: 0.0002
  price_mode: ohlc4  # close|open|hl2|oc2|ohlc4|typical
  range_penalty: 0.0

dataset:
  seq_len: 128  # try 64 if memory/throughput is tight
  episode_len: 512  # null = full window
  behavior_policy: mixed  # mixed only
  behavior_mix:
    - ema3_6_cross
    - ema9_12_cross
    - ema15_18_cross
    - boll_ema12_expansion
    - macd_signal_reversal
    - rsi_extremes
  behavior_stop_loss: 0.1  # stop loss for behavior actions (10% drawdown)
  rtg_gamma: 1.0
  rtg_scale: 1.0
  target_return: 0.0

train:
  mode: offline  # offline|ppo
  batch_size: 64
  epochs: 100
  lr: 0.0003
  weight_decay: 0.0001
  d_model: 128
  n_layers: 4
  n_heads: 4
  dropout: 0.1
  grad_clip: 1.0
  rollout_progress: true
  update_progress: true
  eval_progress: true
  device: auto  # auto|cpu|cuda
  log_dir: outputs/train
  checkpoint_dir: outputs/checkpoints
  run_name: ""
  track_csv: true
  save_config: true
  lr_scheduler:
    type: none  # none|plateau|cosine|step
    metric: val_total_return
    mode: max
    factor: 0.5
    patience: 5
    threshold: 0.0001
    min_lr: 0.000001
    step_size: 10
    gamma: 0.5
    t_max: 100
  early_stopping:
    enabled: false
    metric: val_total_return
    mode: max
    patience: 10
    min_delta: 0.0

rl:
  seed: 42
  action_mode: continuous  # discrete|continuous
  action_dim: 1
  gamma: 0.99  # fallback if dataset.rtg_gamma is not set
  reward_scale: 100.0
  turnover_penalty: 0.1
  position_penalty: 0.1
  drawdown_penalty: 0.1
  eval_every: 1
  eval_mode: deterministic  # deterministic|sample
  eval_samples: 5
  eval_seed: 42
  # PPO knobs (unused by offline DT)
  rollout_steps: 8192
  ppo_epochs: 3
  minibatch_size: 256
  gae_lambda: 0.95
  clip_range: 0.15
  value_coef: 0.5
  entropy_coef: 0.02

backtest:
  initial_cash: 10000
  risk_free: 0.0
  ema_deadzone: 0.001
  random_stay_prob: 0.5
  baseline_seed: 42
  output_dir: outputs/backtest

papertrade:
  base_url: "https://fapi.binance.com"  # https://fapi.binance.com | https://demo-fapi.binance.com
  symbol: "BTCUSDT"
  step_size: 0.001
  interval: "1h"  # 1m|3m|5m|15m|30m|1h|2h|4h|6h|8h|12h|1d|3d|1w|1M
  trade_qty: 0.001
  dry_run: true  # true|false
  use_websocket: true
  ws_base_url: null  # optional override for websocket base URL
  ws_closed_only: true  # only act on closed bars
  ws_reconnect_seconds: 5
  poll_seconds: 10
  stop_loss_pct: 0.1
  position_sizing:
    mode: fixed_qty  # fixed_qty|fixed_notional|equity_fraction
    fixed_qty: 0.001
    fixed_notional: 0.0
    equity_fraction: 0.1
    min_qty: 0.0
    max_qty: null
    max_position_notional: null
  max_drawdown_pct: 0.3
  monitoring:
    enabled: true
    window_bars: 256
    min_sharpe: null
    min_total_return: null
    min_win_rate: null
    max_drawdown_pct: null
    max_error_count: 3
    position_tolerance: 0.0
    drift_zscore_threshold: 3.0
    baseline_path: outputs/papertrade/feature_baseline.json
    alert_log_path: outputs/papertrade/alerts.jsonl
    cooldown_seconds: 300
  log_path: outputs/papertrade/trade_log.csv
  api_key_env: "BINANCE_API_KEY"
  api_secret_env: "BINANCE_API_SECRET"

walk_forward:
  enabled: true  # true|false
  train_bars: 4320
  val_bars: 720
  test_bars: 720
  step_bars: 720
  max_folds: 0  # 0 = all possible
  output_dir: outputs/walk_forward

pipeline:
  registry_path: outputs/models/registry.jsonl
  deploy_dir: outputs/deploy
